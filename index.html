<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>사운드포스트 악보 도서관</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&family=Montserrat:wght@300;600&display=swap" rel="stylesheet">
    <style>
        :root { --wood-dark: #3d2b1f; --wood-grain: #5a4030; --accent-gold: #d4af37; --bg-ivory: #fcfaf7; --text-dark: #2d2d2d; }
        body { font-family: 'Noto Serif KR', serif; background-color: var(--bg-ivory); color: var(--text-dark); margin: 0; padding: 0; }
        header { background: repeating-linear-gradient(90deg, var(--wood-dark), var(--wood-dark) 30px, var(--wood-grain) 31px, var(--wood-dark) 32px); color: white; padding: 3rem 1rem; text-align: center; border-bottom: 4px solid var(--accent-gold); }
        header h1 { font-family: 'Montserrat', sans-serif; font-size: 2.2rem; margin: 0; letter-spacing: 5px; text-transform: uppercase; }
        .container { max-width: 800px; margin: 0 auto; padding: 2rem 1.2rem; }
        .search-area { margin-bottom: 2rem; }
        #searchInput { width: 100%; padding: 15px 20px; border: 1px solid #ddd; border-radius: 30px; font-size: 1rem; box-sizing: border-box; outline: none; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .song-item { background: white; margin-bottom: 1rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); overflow: hidden; border: 1px solid rgba(0,0,0,0.05); }
        .song-header { padding: 1.5rem; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .song-title h3 { margin: 0; font-size: 1.2rem; color: var(--wood-dark); }
        .song-title p { margin: 4px 0 0; font-size: 0.85rem; color: #888; font-family: 'Montserrat', sans-serif; }
        .icon-arrow { width: 24px; height: 24px; transition: transform 0.3s; fill: var(--accent-gold); }
        .part-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; background: #fafafa; }
        .song-item.active .part-content { max-height: 800px; border-top: 1px solid #eee; }
        .song-item.active .icon-arrow { transform: rotate(180deg); }
        .part-grid { padding: 1.5rem; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        @media (min-width: 600px) { .part-grid { grid-template-columns: repeat(3, 1fr); } }
        .part-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 12px 8px; background: white; border: 1px solid #ddd; border-radius: 8px; text-decoration: none; color: var(--text-dark); font-size: 0.85rem; text-align: center; }
        .part-btn span { font-weight: 700; color: var(--accent-gold); margin-bottom: 4px; }
        .part-btn:active { background: var(--wood-dark); color: white; }
        footer { text-align: center; padding: 3rem 1rem; font-size: 0.8rem; color: #aaa; }
    </style>
</head>
<body>

    <header>
        <h1>SOUNDPOST</h1>
        <p>사운드포스트 현악 오케스트라</p>
    </header>

    <div class="container">
        <div class="search-area">
            <input type="text" id="searchInput" placeholder="곡 제목이나 작곡가를 검색하세요..." onkeyup="filterAndRender()">
        </div>
        <div id="songList">
            <p style="text-align: center; color: #888; padding: 2rem;">악보 데이터를 불러오는 중...</p>
        </div>
    </div>

    <footer>&copy; 2026 Soundpost String Orchestra. All rights reserved.</footer>

    <script>
        let musicData = []; // 데이터를 담을 빈 배열

        // [핵심] 외부 JSON 파일을 불러오는 함수
        async function fetchMusicData() {
            try {
                const response = await fetch('data.json'); // 같은 폴더의 data.json 호출
                if (!response.ok) throw new Error('데이터를 불러오지 못했습니다.');
                musicData = await response.json();
                renderSongs(musicData); // 데이터 로드 완료 후 화면 그리기
            } catch (error) {
                document.getElementById('songList').innerHTML = `<p style="text-align:center; color:red;">${error.message}</p>`;
            }
        }

        // 검색어에 따라 필터링하고 화면을 갱신하는 함수
        function filterAndRender() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filtered = musicData.filter(song => 
                song.title.toLowerCase().includes(searchTerm) || 
                song.subtitle.toLowerCase().includes(searchTerm)
            );
            renderSongs(filtered);
        }

        // 데이터를 기반으로 HTML을 생성하는 함수
        function renderSongs(data) {
            const container = document.getElementById('songList');
            container.innerHTML = ''; 

            if (data.length === 0) {
                container.innerHTML = '<p style="text-align:center; color:#888;">검색 결과가 없습니다.</p>';
                return;
            }

            data.forEach((song) => {
                const songItem = document.createElement('div');
                songItem.className = 'song-item';
                
                const partsHtml = song.parts.map(part => `
                    <a href="${part.file}" class="part-btn" download>
                        <span>${part.code}</span> ${part.name}
                    </a>
                `).join('');

                songItem.innerHTML = `
                    <div class="song-header" onclick="toggleAccordion(this)">
                        <div class="song-title">
                            <h3>${song.title}</h3>
                            <p>${song.subtitle}</p>
                        </div>
                        <svg class="icon-arrow" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg>
                    </div>
                    <div class="part-content"><div class="part-grid">${partsHtml}</div></div>
                `;
                container.appendChild(songItem);
            });
        }

        function toggleAccordion(element) {
            element.parentElement.classList.toggle('active');
        }

        // 페이지 시작 시 데이터 로드 실행
        window.onload = fetchMusicData;
    </script>
</body>
</html>
